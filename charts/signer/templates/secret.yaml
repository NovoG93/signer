{{- if and (empty .Values.env.caSecretName) .Values.ca }}
# Auto-generated CA Secret from Helm chart
# This Secret is created only when env.caSecretName is empty
# To use an external Secret, set env.caSecretName and env.caSecretNamespace
{{- $name := include "signer.fullname" . }}
{{- $altNames := list }}
{{- $ipList := list }}
{{- $cert := genSelfSignedCert $name $altNames $ipList (int .Values.ca.validity) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}-ca
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "signer.labels" . | nindent 4 }}
    app.kubernetes.io/component: ca
type: kubernetes.io/tls
data:
  # Helm-generated self-signed CA certificate
  tls.crt: {{ $cert.Cert | b64enc }}
  # Helm-generated CA private key
  tls.key: {{ $cert.Key | b64enc }}
  # Aliases for compatibility with caCertKey and caKeyKey defaults
  ca.crt: {{ $cert.Cert | b64enc }}
  ca.key: {{ $cert.Key | b64enc }}
{{- end }}






